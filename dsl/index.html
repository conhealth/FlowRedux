


<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Kotlin Multiplatform library to create state machines">
      
      
        <link rel="canonical" href="https://freeletics.github.com/flowredux/dsl/">
      
      
        <meta name="author" content="Freeletics">
      
      <link rel="shortcut icon" href="../images/icon-freeletics.png">
      <meta name="generator" content="mkdocs-1.1, mkdocs-material-5.1.1">
    
    
      
        <title>DSL Guide - FlowRedux</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.a676eddb.min.css">
      
        <link rel="stylesheet" href="../assets/stylesheets/palette.b302131d.min.css">
      
      
        
        
        <meta name="theme-color" content="">
      
    
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
      <link rel="stylesheet" href="../css/app.css">
    
    
      
    
    
  </head>
  
  
    
    
    <body dir="ltr" data-md-color-primary="black" data-md-color-accent="white">
  
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#dsl-guide" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href="https://freeletics.github.com/flowredux/" title="FlowRedux" class="md-header-nav__button md-logo" aria-label="FlowRedux">
      
  <img src="../images/icon-freeletics.png" alt="logo">

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3,6H21V8H3V6M3,11H21V13H3V11M3,16H21V18H3V16Z" /></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      
        <div class="md-header-nav__ellipsis">
          <span class="md-header-nav__topic md-ellipsis">
            FlowRedux
          </span>
          <span class="md-header-nav__topic md-ellipsis">
            
              DSL Guide
            
          </span>
        </div>
      
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z" /></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active">
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z" /></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z" /></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header-nav__source">
        
<a href="https://github.com/freeletics/FlowRedux/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    FlowRedux
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
        
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="https://freeletics.github.com/flowredux/" title="FlowRedux" class="md-nav__button md-logo" aria-label="FlowRedux">
      
  <img src="../images/icon-freeletics.png" alt="logo">

    </a>
    FlowRedux
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/freeletics/FlowRedux/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    FlowRedux
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="FlowRedux" class="md-nav__link">
      FlowRedux
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../contributing/" title="Contributing" class="md-nav__link">
      Contributing
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        DSL Guide
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3,9H17V7H3V9M3,13H17V11H3V13M3,17H17V15H3V17M19,17H21V15H19V17M19,7V9H21V7H19M19,13H21V11H19V13Z" /></svg>
        </span>
      </label>
    
    <a href="./" title="DSL Guide" class="md-nav__link md-nav__link--active">
      DSL Guide
    </a>
    
      
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
      </span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#initial-state" class="md-nav__link">
    Initial State
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#instatestate" class="md-nav__link">
    inState&lt;State&gt;
  </a>
  
    <nav class="md-nav" aria-label="inState&lt;State&gt;">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#onenter" class="md-nav__link">
    onEnter
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#onaction" class="md-nav__link">
    on&lt;Action&gt;
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#collectwhileinstate" class="md-nav__link">
    collectWhileInState()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#custom-condition-for-instate" class="md-nav__link">
    Custom condition for inState
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#collectwhileinanystate" class="md-nav__link">
    collectWhileInAnyState()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#setstate" class="md-nav__link">
    SetState
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#getstate" class="md-nav__link">
    GetState
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#flatmappolicy" class="md-nav__link">
    FlatMapPolicy
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#best-practice" class="md-nav__link">
    Best Practice
  </a>
  
    <nav class="md-nav" aria-label="Best Practice">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#the-recommended-way" class="md-nav__link">
    The recommended way
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
    
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../flow_vs_FlowReduxStateMachine/" title="FlowReduxStateMachine vs .reduxStore()" class="md-nav__link">
      FlowReduxStateMachine vs .reduxStore()
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../multiplatform/" title="Multiplatform" class="md-nav__link">
      Multiplatform
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      Javadoc
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z" /></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Javadoc" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
        </span>
        Javadoc
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-6-1" type="checkbox" id="nav-6-1">
    
    <label class="md-nav__link" for="nav-6-1">
      Dsl
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z" /></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Dsl" data-md-level="2">
      <label class="md-nav__title" for="nav-6-1">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
        </span>
        Dsl
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../Javadoc/dsl/" title="Index" class="md-nav__link">
      Index
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-6-1-2" type="checkbox" id="nav-6-1-2">
    
    <label class="md-nav__link" for="nav-6-1-2">
      Alltypes
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z" /></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Alltypes" data-md-level="3">
      <label class="md-nav__title" for="nav-6-1-2">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
        </span>
        Alltypes
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../Javadoc/dsl/alltypes/" title="Index" class="md-nav__link">
      Index
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-6-1-3" type="checkbox" id="nav-6-1-3">
    
    <label class="md-nav__link" for="nav-6-1-3">
      Com.freeletics.flowredux.dsl
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z" /></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Com.freeletics.flowredux.dsl" data-md-level="3">
      <label class="md-nav__title" for="nav-6-1-3">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
        </span>
        Com.freeletics.flowredux.dsl
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../Javadoc/dsl/com.freeletics.flowredux.dsl/" title="Index" class="md-nav__link">
      Index
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Javadoc/dsl/com.freeletics.flowredux.dsl/-in-state-observer-block/" title="in state observer block" class="md-nav__link">
       in state observer block
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Javadoc/dsl/com.freeletics.flowredux.dsl/-in-state-on-enter-block/" title="in state on enter block" class="md-nav__link">
       in state on enter block
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Javadoc/dsl/com.freeletics.flowredux.dsl/-in-state-side-effect-builder/" title="in state side effect builder" class="md-nav__link">
       in state side effect builder
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Javadoc/dsl/com.freeletics.flowredux.dsl/-on-action-block/" title="on action block" class="md-nav__link">
       on action block
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Javadoc/dsl/com.freeletics.flowredux.dsl/-store-wide-builder-block/" title="store wide builder block" class="md-nav__link">
       store wide builder block
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Javadoc/dsl/com.freeletics.flowredux.dsl/-store-wide-collector-block/" title="store wide collector block" class="md-nav__link">
       store wide collector block
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-6-1-3-8" type="checkbox" id="nav-6-1-3-8">
    
    <label class="md-nav__link" for="nav-6-1-3-8">
       flat map policy
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z" /></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label=" flat map policy" data-md-level="4">
      <label class="md-nav__title" for="nav-6-1-3-8">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
        </span>
         flat map policy
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../Javadoc/dsl/com.freeletics.flowredux.dsl/-flat-map-policy/" title="Index" class="md-nav__link">
      Index
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Javadoc/dsl/com.freeletics.flowredux.dsl/-flat-map-policy/-c-o-n-c-a-t/" title="c o n c a t" class="md-nav__link">
       c o n c a t
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Javadoc/dsl/com.freeletics.flowredux.dsl/-flat-map-policy/-l-a-t-e-s-t/" title="l a t e s t" class="md-nav__link">
       l a t e s t
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Javadoc/dsl/com.freeletics.flowredux.dsl/-flat-map-policy/-m-e-r-g-e/" title="m e r g e" class="md-nav__link">
       m e r g e
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-6-1-3-9" type="checkbox" id="nav-6-1-3-9">
    
    <label class="md-nav__link" for="nav-6-1-3-9">
       flow redux state machine
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z" /></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label=" flow redux state machine" data-md-level="4">
      <label class="md-nav__title" for="nav-6-1-3-9">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
        </span>
         flow redux state machine
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../Javadoc/dsl/com.freeletics.flowredux.dsl/-flow-redux-state-machine/" title="Index" class="md-nav__link">
      Index
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Javadoc/dsl/com.freeletics.flowredux.dsl/-flow-redux-state-machine/-init-/" title="init" class="md-nav__link">
       init 
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Javadoc/dsl/com.freeletics.flowredux.dsl/-flow-redux-state-machine/dispatch/" title="Dispatch" class="md-nav__link">
      Dispatch
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Javadoc/dsl/com.freeletics.flowredux.dsl/-flow-redux-state-machine/spec/" title="Spec" class="md-nav__link">
      Spec
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Javadoc/dsl/com.freeletics.flowredux.dsl/-flow-redux-state-machine/state/" title="State" class="md-nav__link">
      State
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-6-1-3-10" type="checkbox" id="nav-6-1-3-10">
    
    <label class="md-nav__link" for="nav-6-1-3-10">
       flow redux store builder
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z" /></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label=" flow redux store builder" data-md-level="4">
      <label class="md-nav__title" for="nav-6-1-3-10">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
        </span>
         flow redux store builder
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../Javadoc/dsl/com.freeletics.flowredux.dsl/-flow-redux-store-builder/" title="Index" class="md-nav__link">
      Index
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Javadoc/dsl/com.freeletics.flowredux.dsl/-flow-redux-store-builder/-init-/" title="init" class="md-nav__link">
       init 
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Javadoc/dsl/com.freeletics.flowredux.dsl/-flow-redux-store-builder/builder-blocks/" title="Builder blocks" class="md-nav__link">
      Builder blocks
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Javadoc/dsl/com.freeletics.flowredux.dsl/-flow-redux-store-builder/collect-while-in-any-state/" title="Collect while in any state" class="md-nav__link">
      Collect while in any state
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Javadoc/dsl/com.freeletics.flowredux.dsl/-flow-redux-store-builder/in-state/" title="In state" class="md-nav__link">
      In state
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-6-1-3-11" type="checkbox" id="nav-6-1-3-11">
    
    <label class="md-nav__link" for="nav-6-1-3-11">
       in state builder block
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z" /></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label=" in state builder block" data-md-level="4">
      <label class="md-nav__title" for="nav-6-1-3-11">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
        </span>
         in state builder block
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../Javadoc/dsl/com.freeletics.flowredux.dsl/-in-state-builder-block/" title="Index" class="md-nav__link">
      Index
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Javadoc/dsl/com.freeletics.flowredux.dsl/-in-state-builder-block/-init-/" title="init" class="md-nav__link">
       init 
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Javadoc/dsl/com.freeletics.flowredux.dsl/-in-state-builder-block/_in-state-side-effect-builders/" title="in state side effect builders" class="md-nav__link">
       in state side effect builders
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Javadoc/dsl/com.freeletics.flowredux.dsl/-in-state-builder-block/_is-in-state/" title="is in state" class="md-nav__link">
       is in state
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Javadoc/dsl/com.freeletics.flowredux.dsl/-in-state-builder-block/collect-while-in-state/" title="Collect while in state" class="md-nav__link">
      Collect while in state
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Javadoc/dsl/com.freeletics.flowredux.dsl/-in-state-builder-block/on-enter/" title="On enter" class="md-nav__link">
      On enter
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Javadoc/dsl/com.freeletics.flowredux.dsl/-in-state-builder-block/on/" title="On" class="md-nav__link">
      On
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-6-1-3-12" type="checkbox" id="nav-6-1-3-12">
    
    <label class="md-nav__link" for="nav-6-1-3-12">
       on action in state side effect builder
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z" /></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label=" on action in state side effect builder" data-md-level="4">
      <label class="md-nav__title" for="nav-6-1-3-12">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
        </span>
         on action in state side effect builder
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../Javadoc/dsl/com.freeletics.flowredux.dsl/-on-action-in-state-side-effect-builder/" title="Index" class="md-nav__link">
      Index
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Javadoc/dsl/com.freeletics.flowredux.dsl/-on-action-in-state-side-effect-builder/-init-/" title="init" class="md-nav__link">
       init 
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-6-1-3-13" type="checkbox" id="nav-6-1-3-13">
    
    <label class="md-nav__link" for="nav-6-1-3-13">
       on enter in state side effect builder
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z" /></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label=" on enter in state side effect builder" data-md-level="4">
      <label class="md-nav__title" for="nav-6-1-3-13">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
        </span>
         on enter in state side effect builder
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../Javadoc/dsl/com.freeletics.flowredux.dsl/-on-enter-in-state-side-effect-builder/" title="Index" class="md-nav__link">
      Index
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Javadoc/dsl/com.freeletics.flowredux.dsl/-on-enter-in-state-side-effect-builder/-init-/" title="init" class="md-nav__link">
       init 
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-6-1-3-14" type="checkbox" id="nav-6-1-3-14">
    
    <label class="md-nav__link" for="nav-6-1-3-14">
       set state
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z" /></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label=" set state" data-md-level="4">
      <label class="md-nav__title" for="nav-6-1-3-14">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
        </span>
         set state
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../Javadoc/dsl/com.freeletics.flowredux.dsl/-set-state/" title="Index" class="md-nav__link">
      Index
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Javadoc/dsl/com.freeletics.flowredux.dsl/-set-state/-init-/" title="init" class="md-nav__link">
       init 
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Javadoc/dsl/com.freeletics.flowredux.dsl/-set-state/invoke/" title="Invoke" class="md-nav__link">
      Invoke
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-6-1-3-15" type="checkbox" id="nav-6-1-3-15">
    
    <label class="md-nav__link" for="nav-6-1-3-15">
      Kotlinx.coroutines.flow. flow
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z" /></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Kotlinx.coroutines.flow. flow" data-md-level="4">
      <label class="md-nav__title" for="nav-6-1-3-15">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
        </span>
        Kotlinx.coroutines.flow. flow
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../Javadoc/dsl/com.freeletics.flowredux.dsl/kotlinx.coroutines.flow.-flow/" title="Index" class="md-nav__link">
      Index
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Javadoc/dsl/com.freeletics.flowredux.dsl/kotlinx.coroutines.flow.-flow/redux-store/" title="Redux store" class="md-nav__link">
      Redux store
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-6-2" type="checkbox" id="nav-6-2">
    
    <label class="md-nav__link" for="nav-6-2">
      Flowredux
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z" /></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Flowredux" data-md-level="2">
      <label class="md-nav__title" for="nav-6-2">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
        </span>
        Flowredux
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../Javadoc/flowredux/" title="Index" class="md-nav__link">
      Index
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-6-2-2" type="checkbox" id="nav-6-2-2">
    
    <label class="md-nav__link" for="nav-6-2-2">
      Alltypes
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z" /></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Alltypes" data-md-level="3">
      <label class="md-nav__title" for="nav-6-2-2">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
        </span>
        Alltypes
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../Javadoc/flowredux/alltypes/" title="Index" class="md-nav__link">
      Index
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-6-2-3" type="checkbox" id="nav-6-2-3">
    
    <label class="md-nav__link" for="nav-6-2-3">
      Com.freeletics.flowredux
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z" /></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Com.freeletics.flowredux" data-md-level="3">
      <label class="md-nav__title" for="nav-6-2-3">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
        </span>
        Com.freeletics.flowredux
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../Javadoc/flowredux/com.freeletics.flowredux/" title="Index" class="md-nav__link">
      Index
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Javadoc/flowredux/com.freeletics.flowredux/-get-state/" title="get state" class="md-nav__link">
       get state
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Javadoc/flowredux/com.freeletics.flowredux/-reducer/" title="reducer" class="md-nav__link">
       reducer
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Javadoc/flowredux/com.freeletics.flowredux/-side-effect/" title="side effect" class="md-nav__link">
       side effect
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-6-2-3-5" type="checkbox" id="nav-6-2-3-5">
    
    <label class="md-nav__link" for="nav-6-2-3-5">
       flow redux logger
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z" /></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label=" flow redux logger" data-md-level="4">
      <label class="md-nav__title" for="nav-6-2-3-5">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
        </span>
         flow redux logger
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../Javadoc/flowredux/com.freeletics.flowredux/-flow-redux-logger/" title="Index" class="md-nav__link">
      Index
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Javadoc/flowredux/com.freeletics.flowredux/-flow-redux-logger/log/" title="Log" class="md-nav__link">
      Log
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-6-2-3-6" type="checkbox" id="nav-6-2-3-6">
    
    <label class="md-nav__link" for="nav-6-2-3-6">
       reducer exception
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z" /></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label=" reducer exception" data-md-level="4">
      <label class="md-nav__title" for="nav-6-2-3-6">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
        </span>
         reducer exception
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../Javadoc/flowredux/com.freeletics.flowredux/-reducer-exception/" title="Index" class="md-nav__link">
      Index
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Javadoc/flowredux/com.freeletics.flowredux/-reducer-exception/-init-/" title="init" class="md-nav__link">
       init 
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-6-2-3-7" type="checkbox" id="nav-6-2-3-7">
    
    <label class="md-nav__link" for="nav-6-2-3-7">
      Kotlinx.coroutines.flow. flow
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z" /></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Kotlinx.coroutines.flow. flow" data-md-level="4">
      <label class="md-nav__title" for="nav-6-2-3-7">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
        </span>
        Kotlinx.coroutines.flow. flow
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../Javadoc/flowredux/com.freeletics.flowredux/kotlinx.coroutines.flow.-flow/" title="Index" class="md-nav__link">
      Index
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Javadoc/flowredux/com.freeletics.flowredux/kotlinx.coroutines.flow.-flow/redux-store/" title="Redux store" class="md-nav__link">
      Redux store
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
      </span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#initial-state" class="md-nav__link">
    Initial State
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#instatestate" class="md-nav__link">
    inState&lt;State&gt;
  </a>
  
    <nav class="md-nav" aria-label="inState&lt;State&gt;">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#onenter" class="md-nav__link">
    onEnter
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#onaction" class="md-nav__link">
    on&lt;Action&gt;
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#collectwhileinstate" class="md-nav__link">
    collectWhileInState()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#custom-condition-for-instate" class="md-nav__link">
    Custom condition for inState
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#collectwhileinanystate" class="md-nav__link">
    collectWhileInAnyState()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#setstate" class="md-nav__link">
    SetState
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#getstate" class="md-nav__link">
    GetState
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#flatmappolicy" class="md-nav__link">
    FlatMapPolicy
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#best-practice" class="md-nav__link">
    Best Practice
  </a>
  
    <nav class="md-nav" aria-label="Best Practice">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#the-recommended-way" class="md-nav__link">
    The recommended way
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/freeletics/FlowRedux/edit/master/docs/dsl.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71,7.04C21.1,6.65 21.1,6 20.71,5.63L18.37,3.29C18,2.9 17.35,2.9 16.96,3.29L15.12,5.12L18.87,8.87M3,17.25V21H6.75L17.81,9.93L14.06,6.18L3,17.25Z" /></svg>
                  </a>
                
                
                  
                
                
                <h1 id="dsl-guide">DSL Guide<a class="headerlink" href="#dsl-guide" title="Permanent link">&para;</a></h1>
<p>FlowRedux provides a convenient DSL to describe your state machine.
This page introduces you the DSL that you can use.</p>
<p>To do that we will stick with a simple example of loading a list of items from a web service.
As you read this section and more concepts of the DSL will be introduced we will extend this sample.</p>
<p>For now to get started, let&rsquo;s define the <code>States</code> our state machine has.
As said before we loads a list of items from a web service
and display that list.
While loading the list we show a loading indicator on the screen and
if an error occurs we show an error message on the screen with a retry button.</p>
<p>This gives us the following states:</p>
<div class="highlight"><pre><span></span><code><span class="k">sealed</span> <span class="k">class</span> <span class="nc">State</span> <span class="p">{</span>

    <span class="c1">// Shows a loading indicator on screen</span>
    <span class="k">object</span> <span class="nc">LoadingState</span> <span class="p">:</span> <span class="n">State</span><span class="p">()</span>

    <span class="c1">// List of items loaded successfully, show it on screen</span>
    <span class="k">data</span> <span class="k">class</span> <span class="nc">ShowContentState</span><span class="p">(</span><span class="k">val</span> <span class="py">items</span> <span class="p">:</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">Item</span><span class="p">&gt;)</span> <span class="p">:</span> <span class="n">State</span><span class="p">()</span>

    <span class="c1">// Error while loading happened</span>
    <span class="k">data</span> <span class="k">class</span> <span class="nc">ErrorState</span><span class="p">(</span><span class="k">val</span> <span class="py">cause</span> <span class="p">:</span> <span class="n">Throwable</span><span class="p">)</span> <span class="p">:</span> <span class="n">State</span><span class="p">()</span>
<span class="p">}</span>
</code></pre></div>

<p>If we reached <code>ErrorState</code> we display an error message but also a button a user can click to retry loading the items.
This gives us the following <code>Actions</code>:</p>
<div class="highlight"><pre><span></span><code><span class="k">sealed</span> <span class="k">class</span> <span class="nc">Action</span> <span class="p">{</span>
    <span class="k">object</span> <span class="nc">RetryLoadingAction</span> <span class="p">:</span> <span class="n">Action</span><span class="p">()</span>
<span class="p">}</span>
</code></pre></div>

<h2 id="initial-state">Initial State<a class="headerlink" href="#initial-state" title="Permanent link">&para;</a></h2>
<p>Every <code>FlowReduxStateMachine</code> needs an initial state.
This is in which state the state machine starts.
In our example we start with the <code>LoadingState</code>.</p>
<div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">MyStateMachine</span><span class="p">(</span>
    <span class="k">private</span> <span class="k">val</span> <span class="py">httpClient</span><span class="p">:</span> <span class="n">HttpClient</span>
<span class="p">)</span> <span class="p">:</span> <span class="n">FlowReduxStateMachine</span><span class="p">&lt;</span><span class="n">State</span><span class="p">,</span> <span class="n">Action</span><span class="p">&gt;(</span><span class="n">initialState</span> <span class="p">=</span> <span class="n">LoadingState</span><span class="p">)</span> <span class="p">{</span>

    <span class="n">init</span> <span class="p">{</span>
        <span class="n">spec</span> <span class="p">{</span>
            <span class="c1">// will be filled in next section</span>
            <span class="p">...</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<p>Please note the constructor parameter of <code>FlowReduxStateMachine(initialState = ...)</code>.
This is how you define the initial state of your state machine.
Next, we already see that we need an <code>init {...}</code> block containing a <code>spec { ... }</code> block inside.
The <code>spec { ... }</code> block is actually where we write our DSL inside.</p>
<h2 id="instatestate">inState<code>&lt;State&gt;</code><a class="headerlink" href="#instatestate" title="Permanent link">&para;</a></h2>
<p>The first concept we learn is <code>inState</code></p>
<div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">MyStateMachine</span><span class="p">(</span>
    <span class="k">private</span> <span class="k">val</span> <span class="py">httpClient</span><span class="p">:</span> <span class="n">HttpClient</span>
<span class="p">)</span> <span class="p">:</span> <span class="n">FlowReduxStateMachine</span><span class="p">&lt;</span><span class="n">State</span><span class="p">,</span> <span class="n">Action</span><span class="p">&gt;(</span><span class="n">initialState</span> <span class="p">=</span> <span class="n">LoadingState</span><span class="p">)</span> <span class="p">{</span>

    <span class="n">init</span> <span class="p">{</span>
        <span class="n">spec</span> <span class="p">{</span>
            <span class="n">inState</span><span class="p">&lt;</span><span class="n">LoadingState</span><span class="p">&gt;</span> <span class="p">{</span>
                <span class="p">...</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<p>Please note that <code>inState</code> itself doesn&rsquo;t do anything.
All we did so far with <code>inState&lt;LoadingState&gt;</code> is set an entry point.
Next let&rsquo;s discuss what an <code>inState</code> can contain as triggers to actually &ldquo;do something&rdquo;:</p>
<ol>
<li><code>onEnter</code>: Triggers whenever we enter that state</li>
<li><code>on&lt;Action&gt;</code>: Triggers whenever we are in this state and the specified action is triggered from the outside by calling <code>FlowReduxStateMachine.dispatch(action)</code>.</li>
<li><code>collectWhileInState( flow )</code>: You can subscribe to any arbitrary <code>Flow</code> while your state machine is in that state.</li>
</ol>
<p>Let&rsquo;s try to go through them as we build our state machine:</p>
<h3 id="onenter">onEnter<a class="headerlink" href="#onenter" title="Permanent link">&para;</a></h3>
<p>What do we want to do when we enter the <code>LoadingState</code>?
We want to do the http request, right?
Let&rsquo;s do that by extending our example:</p>
<div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">MyStateMachine</span><span class="p">(</span>
    <span class="k">private</span> <span class="k">val</span> <span class="py">httpClient</span><span class="p">:</span> <span class="n">HttpClient</span>
<span class="p">)</span> <span class="p">:</span> <span class="n">FlowReduxStateMachine</span><span class="p">&lt;</span><span class="n">State</span><span class="p">,</span> <span class="n">Action</span><span class="p">&gt;(</span><span class="n">initialState</span> <span class="p">=</span> <span class="n">LoadingState</span><span class="p">)</span> <span class="p">{</span>

    <span class="n">init</span> <span class="p">{</span>
        <span class="n">spec</span> <span class="p">{</span>
            <span class="n">inState</span><span class="p">&lt;</span><span class="n">LoadingState</span><span class="p">&gt;</span> <span class="p">{</span>
                <span class="n">onEnter</span> <span class="p">{</span> <span class="n">getState</span><span class="p">,</span> <span class="n">setState</span> <span class="p">-&gt;</span>
                    <span class="c1">// we entered the LoadingState, so let&#39;s do the http request</span>
                    <span class="k">try</span> <span class="p">{</span>
                        <span class="k">val</span> <span class="py">items</span> <span class="p">=</span> <span class="n">httpClient</span><span class="p">.</span><span class="n">loadItems</span><span class="p">()</span>
                        <span class="n">setState</span> <span class="p">{</span> <span class="n">ShowContentState</span><span class="p">(</span><span class="n">items</span><span class="p">)</span> <span class="p">}</span>
                    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">t</span> <span class="p">:</span> <span class="n">Throwable</span><span class="p">)</span> <span class="p">{</span>
                        <span class="n">setState</span> <span class="p">{</span> <span class="n">ErrorState</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="p">}</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<p>There are a some new things like  <code>onEnter</code>, <code>getState</code> and <code>setState</code>. We will cover <a href="#getstate">getState</a> and <a href="#setstate">setState</a> in dedicated sections.
All you have to know about <code>setState</code> for now is that this is the way to set the next state in your state machine.
Let&rsquo;s talk about <code>onEnter</code>:</p>
<ul>
<li><strong><code>onEnter { ... }</code> is running asynchronously in a coroutine</strong>.
That means whatever you do inside the <code>onEnter</code> block is not blocking anything else.
You can totally run here long running and expensive calls (like doing an http request).</li>
<li><strong><code>onEnter { ... }</code> doesn&rsquo;t get canceled</strong> when the state machine transitioned to another state original state. Example:
 <div class="highlight"><pre><span></span><code><span class="n">inState</span><span class="p">&lt;</span><span class="n">LoadingState</span><span class="p">&gt;</span> <span class="p">{</span>
   <span class="n">onEnter</span> <span class="p">{</span> <span class="n">getState</span><span class="p">,</span> <span class="n">setState</span> <span class="p">-&gt;</span>
       <span class="n">setState</span> <span class="p">{</span> <span class="n">ErrorState</span><span class="p">(</span><span class="n">Exception</span><span class="p">(</span><span class="s">&quot;Fake Exception&quot;</span><span class="p">)</span> <span class="p">}</span>
       <span class="n">doA</span><span class="p">()</span>
       <span class="n">doSomethingLongRunning</span><span class="p">()</span>
   <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
 <code>doA()</code> and <code>doSomethingLongRunning()</code> are still executed even if <code>setState { ... }</code> which got executed before causes our state machine to move to the next state.
 The takeaway is: the full <code>onEnter { ... }</code> block will be executed once a state has been entered (there is an exception, we will talk about that in <a href="#flatmappolicy">FlatMapPolicy</a> section).</li>
</ul>
<h3 id="onaction">on<code>&lt;Action&gt;</code><a class="headerlink" href="#onaction" title="Permanent link">&para;</a></h3>
<p>How do we deal with external user input like clicks in FlowRedux? 
This is what Actions are for. 
In FlowRedux DSL you can react on Actions by using a <code>on&lt;MyAction&gt;{ ... }</code> block.</p>
<p>In our example we want to retry loading if we are in <code>ErrorState</code> and the user clicks on a retry button. 
Clicking on that button dispatches a <code>RetryLoadingAction</code> to our state machine.
Let&rsquo;s extend our FlowReduxStateMachine to react on such an action if the current state is <code>ErrorState</code>:</p>
<div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">MyStateMachine</span><span class="p">(</span>
    <span class="k">private</span> <span class="k">val</span> <span class="py">httpClient</span><span class="p">:</span> <span class="n">HttpClient</span>
<span class="p">)</span> <span class="p">:</span> <span class="n">FlowReduxStateMachine</span><span class="p">&lt;</span><span class="n">State</span><span class="p">,</span> <span class="n">Action</span><span class="p">&gt;(</span><span class="n">initialState</span> <span class="p">=</span> <span class="n">LoadingState</span><span class="p">)</span> <span class="p">{</span>

    <span class="n">init</span> <span class="p">{</span>
        <span class="n">spec</span> <span class="p">{</span>
            <span class="n">inState</span><span class="p">&lt;</span><span class="n">LoadingState</span><span class="p">&gt;</span> <span class="p">{</span>
                <span class="n">onEnter</span> <span class="p">{</span> <span class="n">getState</span><span class="p">,</span> <span class="n">setState</span> <span class="p">-&gt;</span>
                    <span class="c1">// we entered the LoadingState, so let&#39;s do the http request</span>
                    <span class="k">try</span> <span class="p">{</span>
                        <span class="k">val</span> <span class="py">items</span> <span class="p">=</span> <span class="n">httpClient</span><span class="p">.</span><span class="n">loadItems</span><span class="p">()</span>
                        <span class="n">setState</span> <span class="p">{</span> <span class="n">ShowContentState</span><span class="p">(</span><span class="n">items</span><span class="p">)</span> <span class="p">}</span>
                    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">t</span> <span class="p">:</span> <span class="n">Throwable</span><span class="p">)</span> <span class="p">{</span>
                        <span class="n">setState</span> <span class="p">{</span> <span class="n">ErrorState</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="p">}</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span>

            <span class="c1">// let&#39;s add a new inState{...} with an on{...} block </span>
            <span class="n">inState</span><span class="p">&lt;</span><span class="n">ErrorState</span><span class="p">&gt;</span> <span class="p">{</span>
               <span class="n">on</span><span class="p">&lt;</span><span class="n">RetryLoadingAction</span><span class="p">&gt;</span> <span class="p">{</span> <span class="n">action</span><span class="p">,</span> <span class="n">getState</span><span class="p">,</span> <span class="n">setState</span> <span class="p">-&gt;</span>
                  <span class="c1">// This block triggers if we are in ErrorState </span>
                  <span class="c1">// RetryLoadingAction has been dispatched to this state machine.</span>
                  <span class="c1">// In that case we transition to LoadingState which then starts the http</span>
                  <span class="c1">// request to load items.</span>

                  <span class="n">setState</span> <span class="p">{</span> <span class="n">LoadingState</span> <span class="p">}</span>
               <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<p>A <code>on { ... }</code> block gets 3 parameters:  <code>action</code> which is the actual instance of the <code>Action</code> that
triggered this block and <code>setState</code> and <code>getState</code> which you have also seen in <code>onEnter { ... }</code> block.
<code>on { ... }</code> is actually pretty similar to <code>onEnter {...}</code> just with a different &ldquo;trigger&rdquo; (action vs. entering a state).
Furthermore, <code>on { ... }</code> has the same characteristics as <code>onEnter { ... }</code>:</p>
<ul>
<li><strong><code>on&lt;MyAction&gt; { ... }</code> is running asynchronously in a coroutine</strong>.
You can totally run here long running and expensive calls (like doing an http request).</li>
<li><strong><code>on&lt;MyAction&gt; { ... }</code> doesn&rsquo;t get canceled</strong> when the state machine transitioned to another state original state.
See <a href="#onenter">onEnter</a> section for more details.</li>
</ul>
<h3 id="collectwhileinstate">collectWhileInState()<a class="headerlink" href="#collectwhileinstate" title="Permanent link">&para;</a></h3>
<p>This one is useful if you want to collect a <code>Flow</code> only while being exactly in that state.
To give a concrete example how this is useful let&rsquo;s extend our example from above.
Let&rsquo;s say whenever our state machine is in <code>ErrorState</code> we want to retry loading the items after
3 seconds in <code>ErrorState</code> or anytime before the 3 seconds have elapsed if the user clicks the retry button.
Furthermore the 3 seconds countdown timer should be displayed in our app:</p>
<p>To implement this let&rsquo;s first extend our <code>ErrorState</code>:</p>
<div class="highlight"><pre><span></span><code><span class="k">data</span> <span class="k">class</span> <span class="nc">ErrorState</span><span class="p">(</span>
    <span class="k">val</span> <span class="py">cause</span> <span class="p">:</span> <span class="n">Throwable</span><span class="p">,</span>
    <span class="k">val</span> <span class="py">countdown</span> <span class="p">:</span> <span class="n">Int</span>    <span class="c1">// This value is decreased from 3 then 2 then 1 and represents the countdown value.</span>
<span class="p">)</span> <span class="p">:</span> <span class="n">State</span><span class="p">()</span>
</code></pre></div>

<p>Now let&rsquo;s add some countdown capabilities to our state machine by using <code>collectWhileInState()</code>:</p>
<div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">MyStateMachine</span><span class="p">(</span>
    <span class="k">private</span> <span class="k">val</span> <span class="py">httpClient</span><span class="p">:</span> <span class="n">HttpClient</span>
<span class="p">)</span> <span class="p">:</span> <span class="n">FlowReduxStateMachine</span><span class="p">&lt;</span><span class="n">State</span><span class="p">,</span> <span class="n">Action</span><span class="p">&gt;(</span><span class="n">initialState</span> <span class="p">=</span> <span class="n">LoadingState</span><span class="p">)</span> <span class="p">{</span>

    <span class="n">init</span> <span class="p">{</span>
        <span class="n">spec</span> <span class="p">{</span>
            <span class="n">inState</span><span class="p">&lt;</span><span class="n">LoadingState</span><span class="p">&gt;</span> <span class="p">{</span>
                <span class="n">onEnter</span> <span class="p">{</span> <span class="n">getState</span><span class="p">,</span> <span class="n">setState</span> <span class="p">-&gt;</span>
                    <span class="c1">// we entered the LoadingState, so let&#39;s do the http request</span>
                    <span class="k">try</span> <span class="p">{</span>
                        <span class="k">val</span> <span class="py">items</span> <span class="p">=</span> <span class="n">httpClient</span><span class="p">.</span><span class="n">loadItems</span><span class="p">()</span>
                        <span class="n">setState</span> <span class="p">{</span> <span class="n">ShowContentState</span><span class="p">(</span><span class="n">items</span><span class="p">)</span> <span class="p">}</span>
                    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">t</span> <span class="p">:</span> <span class="n">Throwable</span><span class="p">)</span> <span class="p">{</span>
                        <span class="n">setState</span> <span class="p">{</span> <span class="n">ErrorState</span><span class="p">(</span><span class="n">cause</span> <span class="p">=</span> <span class="n">t</span><span class="p">,</span> <span class="n">countdown</span> <span class="p">=</span> <span class="m">3</span><span class="p">)</span> <span class="p">}</span> <span class="c1">// Countdown starts with 3 seconds</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span>

            <span class="n">inState</span><span class="p">&lt;</span><span class="n">ErrorState</span><span class="p">&gt;</span> <span class="p">{</span>
               <span class="n">on</span><span class="p">&lt;</span><span class="n">RetryLoadingAction</span><span class="p">&gt;</span> <span class="p">{</span> <span class="n">action</span><span class="p">,</span> <span class="n">getState</span><span class="p">,</span> <span class="n">setState</span> <span class="p">-&gt;</span>
                  <span class="n">setState</span> <span class="p">{</span> <span class="n">LoadingState</span> <span class="p">}</span>
               <span class="p">}</span>

               <span class="k">val</span> <span class="py">timer</span> <span class="p">:</span> <span class="n">Flow</span><span class="p">&lt;</span><span class="n">Int</span><span class="p">&gt;</span> <span class="p">=</span> <span class="n">timerThatEmitsEverySecond</span><span class="p">()</span>
               <span class="n">collectWhileInState</span><span class="p">(</span><span class="n">timer</span><span class="p">)</span> <span class="p">{</span> <span class="n">value</span><span class="p">,</span> <span class="n">getState</span><span class="p">,</span> <span class="n">setState</span> <span class="p">-&gt;</span>
                    <span class="c1">// This block triggers every time the timer emits</span>
                    <span class="c1">// which happens every second</span>
                    <span class="k">val</span> <span class="py">state</span> <span class="p">=</span> <span class="n">getState</span><span class="p">()</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">state</span> <span class="k">is</span> <span class="n">ErrorState</span><span class="p">)</span> <span class="p">{</span>
                        <span class="k">val</span> <span class="py">countdownTimeLeft</span> <span class="p">=</span> <span class="n">state</span><span class="p">.</span><span class="n">countdown</span>
                        <span class="k">if</span> <span class="p">(</span><span class="n">countdownTimeLeft</span> <span class="p">&gt;</span> <span class="m">0</span><span class="p">)</span>
                            <span class="n">setState</span> <span class="p">{</span> <span class="n">state</span><span class="p">.</span><span class="n">copy</span><span class="p">(</span><span class="n">countdown</span> <span class="p">=</span> <span class="n">countdownTimeLeft</span> <span class="p">-</span> <span class="m">1</span><span class="p">)</span> <span class="p">}</span> <span class="c1">//  decrease the countdown by 1 second</span>
                        <span class="k">else</span>
                            <span class="n">setState</span> <span class="p">{</span> <span class="n">LoadingState</span> <span class="p">}</span> <span class="c1">// transition to the LoadingState</span>
                    <span class="p">}</span>
               <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">private</span> <span class="k">fun</span> <span class="nf">timerThatEmitsEverySecond</span><span class="p">()</span> <span class="p">:</span> <span class="n">Flow</span><span class="p">&lt;</span><span class="n">Int</span><span class="p">&gt;</span> <span class="p">{</span>
        <span class="k">var</span> <span class="py">timeElapsed</span> <span class="p">=</span> <span class="m">0</span>
        <span class="k">while</span> <span class="p">(</span><span class="n">isActive</span><span class="p">)</span> <span class="p">{</span>  <span class="c1">// is Flow still active?</span>
            <span class="n">delay</span><span class="p">(</span><span class="m">1000</span><span class="p">)</span>     <span class="c1">// wait 1 second</span>
            <span class="n">timeElapsed</span><span class="p">++</span>
            <span class="n">emit</span><span class="p">(</span><span class="n">timeElapsed</span><span class="p">)</span> <span class="c1">// Flow Emits value</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<p>Let&rsquo;s look at the source code above step by step.
Whenever we are in <code>LoadingState</code> and an error occurs while loading the items we go into
<code>ErrorState</code>. Nothing new.
What is new is that <code>ErrorState</code> contains an additional field  <code>countdown</code> which we set on
transitioning from <code>LoadingState</code> to <code>ErrorState(countdown = 3)</code> (means 3 seconds left).</p>
<p>We extend <code>inState&lt;ErrorState&gt; { ... }</code> block and add a <code>collectWhileInState(timer)</code>.
<code>timer</code> is a <code>Flow&lt;Int&gt;</code> that emits a new (incremented) number every second.
<code>collectWhileInState(timer)</code> calls <code>.collect {...}</code> on the timer flow and executes the block with the
parameters <code>value</code>, <code>getState</code> and <code>setState</code> every time <code>timer</code> emits a new value.
In other words: instead of calling <code>timer.collect { ... }</code> you call <code>collectWhileInState(timer) { ... }</code> to collect the Flow&rsquo;s values as long as the state machine is in that state.</p>
<p>But here is the deal: it automatically cancels the timer once the state machine transitioned away from
<code>ErrorState</code> into another state.
This happens either when the user clicks on the retry button and causes <code>on&lt;RetryLoadingAction&gt;</code> to be dispatched
or when 3 seconds have elapsed.
To keep track how many seconds are left we decrease <code>ErrorState.countdown</code> field after every second until we reached zero.
On zero we call <code>setState { LoadingState }</code> to do the state transition.</p>
<p><code>collectWhileInState(anyFlow) { value, getState, setState -&gt; ... }</code> has 3 parameters:
<code>value</code> is the value emitted by the flow, <a href="#getstate">getState</a> to get the current state and <a href="#setState">setState</a> to do a state transition.</p>
<p>In contrast to <code>onEnter</code> and <code>on&lt;Action&gt;</code> block <code>collectWhileInState()</code> block stops the execution once the state machine is not in the original <code>inState&lt;State&gt;</code> anymore.</p>
<h2 id="custom-condition-for-instate">Custom condition for inState<a class="headerlink" href="#custom-condition-for-instate" title="Permanent link">&para;</a></h2>
<p>We already covered <code>inState&lt;State&gt;</code> that builds upon the recommended best practice that every State
in your state machine is expressed us it&rsquo;s own type in Kotlin.
Again, this is a best practice and the recommended way.</p>
<p>Sometimes, however, you need a bit more flexibility then just relaying on type.
For that use case you can use <code>inState(isInState: (State) -&gt; Boolean)</code>.</p>
<p>Example: One could have also modeled the state for our example above as the following:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// TO MODEL YOUR STATE LIKE THIS IS NOT BEST PRACTICE! Use sealed class instead.</span>
<span class="k">data</span> <span class="k">class</span> <span class="nc">State</span> <span class="p">(</span>
    <span class="k">val</span> <span class="py">loading</span> <span class="p">:</span> <span class="n">Boolean</span><span class="p">,</span> <span class="c1">// true means loading, false means not loading</span>
    <span class="k">val</span> <span class="py">items</span> <span class="p">:</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">Items</span><span class="p">&gt;,</span> <span class="c1">// empty list if no items loaded yet</span>
    <span class="k">val</span> <span class="py">error</span> <span class="p">:</span> <span class="n">Throwable</span><span class="p">?,</span> <span class="c1">// if not null we are in error state</span>
    <span class="k">val</span> <span class="py">errorCountDown</span> <span class="p">:</span> <span class="n">Int</span><span class="p">?</span> <span class="c1">// the seconds for the error countdown</span>
<span class="p">)</span>
</code></pre></div>

<p><strong>AGAIN, the example shown above is not the recommended way.
We strongly recommend to use sealed classes instead to model state as shown at the beginning of this document.</strong></p>
<p>We just do this for demo purpose to demonstrate a way how to customize <code>inState</code>.
Given the state from above, what we can do now with our DSL is the following:</p>
<div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">MyStateMachine</span><span class="p">(</span>
    <span class="k">private</span> <span class="k">val</span> <span class="py">httpClient</span><span class="p">:</span> <span class="n">HttpClient</span>
<span class="p">)</span> <span class="p">:</span> <span class="n">FlowReduxStateMachine</span><span class="p">&lt;</span><span class="n">State</span><span class="p">,</span> <span class="n">Action</span><span class="p">&gt;(</span><span class="n">initialState</span> <span class="p">=</span> <span class="n">State</span><span class="p">(</span><span class="n">loading</span> <span class="p">=</span> <span class="k">true</span><span class="p">,</span> <span class="n">items</span> <span class="p">=</span> <span class="n">emptyList</span><span class="p">(),</span> <span class="n">error</span> <span class="p">=</span> <span class="k">null</span><span class="p">,</span> <span class="n">errorCountDown</span> <span class="p">=</span> <span class="k">null</span><span class="p">))</span> <span class="p">{</span>

    <span class="n">init</span> <span class="p">{</span>
        <span class="n">spec</span> <span class="p">{</span>
            <span class="n">inState</span><span class="p">(</span> <span class="n">isInState</span> <span class="p">=</span> <span class="p">{</span><span class="n">state</span> <span class="p">-&gt;</span> <span class="n">state</span><span class="p">.</span><span class="n">loading</span> <span class="p">==</span> <span class="k">true</span><span class="p">}</span> <span class="p">)</span> <span class="p">{</span>
                <span class="n">onEnter</span> <span class="p">{</span> <span class="n">getState</span><span class="p">,</span> <span class="n">setState</span> <span class="p">-&gt;</span>
                    <span class="c1">// we entered the LoadingState, so let&#39;s do the http request</span>
                    <span class="k">try</span> <span class="p">{</span>
                        <span class="k">val</span> <span class="py">items</span> <span class="p">=</span> <span class="n">httpClient</span><span class="p">.</span><span class="n">loadItems</span><span class="p">()</span>
                        <span class="n">setState</span> <span class="p">{</span>
                            <span class="n">State</span><span class="p">(</span><span class="n">loading</span> <span class="p">=</span> <span class="k">false</span><span class="p">,</span> <span class="n">items</span> <span class="p">=</span> <span class="n">items</span><span class="p">,</span> <span class="n">error</span> <span class="p">=</span> <span class="k">null</span><span class="p">,</span> <span class="n">errorCountdown</span> <span class="p">=</span> <span class="k">null</span><span class="p">)</span>
                        <span class="p">}</span>
                    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">t</span> <span class="p">:</span> <span class="n">Throwable</span><span class="p">)</span> <span class="p">{</span>
                        <span class="n">setState</span> <span class="p">{</span>
                            <span class="n">State</span><span class="p">(</span><span class="n">loading</span> <span class="p">=</span> <span class="k">false</span><span class="p">,</span> <span class="n">items</span> <span class="p">=</span> <span class="n">emptyList</span><span class="p">(),</span> <span class="n">error</span> <span class="p">=</span> <span class="n">t</span><span class="p">,</span> <span class="n">errorCountdown</span> <span class="p">=</span> <span class="m">3</span><span class="p">)</span>
                        <span class="p">}</span> <span class="c1">// Countdown starts with 3 seconds</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span>

            <span class="n">inState</span><span class="p">(</span> <span class="n">isInState</span> <span class="p">=</span> <span class="p">{</span><span class="n">state</span> <span class="p">-&gt;</span> <span class="n">state</span><span class="p">.</span><span class="n">error</span> <span class="p">!=</span> <span class="k">null</span> <span class="p">}</span> <span class="p">)</span> <span class="p">{</span>
               <span class="n">on</span><span class="p">&lt;</span><span class="n">RetryLoadingAction</span><span class="p">&gt;</span> <span class="p">{</span> <span class="n">action</span><span class="p">,</span> <span class="n">getState</span><span class="p">,</span> <span class="n">setState</span> <span class="p">-&gt;</span>
                  <span class="n">setState</span> <span class="p">{</span>
                     <span class="n">State</span><span class="p">(</span><span class="n">loading</span> <span class="p">=</span> <span class="k">true</span><span class="p">,</span> <span class="n">items</span> <span class="p">=</span> <span class="n">emptyList</span><span class="p">(),</span> <span class="n">error</span> <span class="p">=</span> <span class="k">null</span><span class="p">,</span> <span class="n">errorCountdown</span> <span class="p">=</span> <span class="k">null</span><span class="p">)</span>
                  <span class="p">}</span>
               <span class="p">}</span>

               <span class="k">val</span> <span class="py">timer</span> <span class="p">:</span> <span class="n">Flow</span><span class="p">&lt;</span><span class="n">Int</span><span class="p">&gt;</span> <span class="p">=</span> <span class="n">timerThatEmitsEverySecond</span><span class="p">()</span>
               <span class="n">collectWhileInState</span><span class="p">(</span><span class="n">timer</span><span class="p">)</span> <span class="p">{</span> <span class="n">value</span><span class="p">,</span> <span class="n">getState</span><span class="p">,</span> <span class="n">setState</span> <span class="p">-&gt;</span>
                    <span class="c1">// This block triggers every time the timer emits</span>
                    <span class="c1">// which happens every second</span>
                    <span class="k">val</span> <span class="py">state</span> <span class="p">=</span> <span class="n">getState</span><span class="p">()</span>
                    <span class="k">val</span> <span class="py">countdownTimeLeft</span> <span class="p">=</span> <span class="n">state</span><span class="p">.</span><span class="n">errorCountdown</span><span class="o">!!</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">countdownTimeLeft</span> <span class="p">&gt;</span> <span class="m">0</span><span class="p">)</span>
                        <span class="n">setState</span> <span class="p">{</span> <span class="n">state</span><span class="p">.</span><span class="n">copy</span><span class="p">(</span><span class="n">errorCountdown</span> <span class="p">=</span> <span class="n">countdownTimeLeft</span> <span class="p">-</span> <span class="m">1</span><span class="p">)</span> <span class="p">}</span> <span class="c1">//  decrease the countdown by 1 second</span>
                    <span class="k">else</span>
                        <span class="n">setState</span> <span class="p">{</span>
                          <span class="n">State</span><span class="p">(</span><span class="n">loading</span> <span class="p">=</span> <span class="k">true</span><span class="p">,</span> <span class="n">items</span> <span class="p">=</span> <span class="n">emptyList</span><span class="p">(),</span> <span class="n">error</span> <span class="p">=</span> <span class="k">null</span><span class="p">,</span> <span class="n">errorCountdown</span> <span class="p">=</span> <span class="k">null</span><span class="p">)</span> <span class="c1">// transition to the LoadingState</span>
                        <span class="p">}</span>
                    <span class="p">}</span>
               <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<p>Instead of <code>inState&lt;State&gt; { ... }</code> we can use another version of <code>inState</code> name that instead of
generics take a lambda as parameter that looks like <code>(State) -&gt; Boolean</code> so that.
If that lambda returns <code>true</code> it means we are in that state, otherwise not (returning false).
The rest still remains the same.
You can use <code>onEnter</code>, <code>on&lt;Action&gt;</code> and <code>collectWhileInState</code> the exact way as you already know.</p>
<h2 id="collectwhileinanystate">collectWhileInAnyState()<a class="headerlink" href="#collectwhileinanystate" title="Permanent link">&para;</a></h2>
<p>If for whatever reason you want to trigger a state change out of  <code>inState&lt;&gt;</code>, <code>onEnter { ... }</code>, <code>on&lt;Action&gt;</code> or <code>collectWhileInState { ... }</code> by observing a <code>Flow</code> then <code>collectWhileInAnyState</code> is what you are looking for:</p>
<div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">MyStateMachine</span><span class="p">(</span>
    <span class="k">private</span> <span class="k">val</span> <span class="py">httpClient</span><span class="p">:</span> <span class="n">HttpClient</span>
<span class="p">)</span> <span class="p">:</span> <span class="n">FlowReduxStateMachine</span><span class="p">&lt;</span><span class="n">State</span><span class="p">,</span> <span class="n">Action</span><span class="p">&gt;(</span><span class="n">initialState</span> <span class="p">=</span> <span class="n">LoadingState</span><span class="p">)</span> <span class="p">{</span>

    <span class="n">init</span> <span class="p">{</span>
        <span class="n">spec</span> <span class="p">{</span>
            <span class="n">inState</span><span class="p">&lt;</span><span class="n">LoadingState</span><span class="p">&gt;</span> <span class="p">{</span>
                <span class="n">onEnter</span> <span class="p">{</span> <span class="n">getState</span><span class="p">,</span> <span class="n">setState</span> <span class="p">-&gt;</span>
                  <span class="p">...</span>
                <span class="p">}</span>
            <span class="p">}</span>

            <span class="n">inState</span><span class="p">&lt;</span><span class="n">ErrorState</span><span class="p">&gt;</span> <span class="p">{</span>
               <span class="n">on</span><span class="p">&lt;</span><span class="n">RetryLoadingAction</span><span class="p">&gt;</span> <span class="p">{</span> <span class="n">action</span><span class="p">,</span> <span class="n">getState</span><span class="p">,</span> <span class="n">setState</span> <span class="p">-&gt;</span>
                  <span class="p">...</span>
               <span class="p">}</span>

               <span class="n">collectWhileInState</span><span class="p">(</span><span class="n">timer</span><span class="p">)</span> <span class="p">{</span> <span class="n">value</span><span class="p">,</span> <span class="n">getState</span><span class="p">,</span> <span class="n">setState</span> <span class="p">-&gt;</span>
                  <span class="p">...</span>
               <span class="p">}</span>
            <span class="p">}</span>

            <span class="k">val</span> <span class="py">aFlow</span> <span class="p">:</span> <span class="n">Flow</span><span class="p">&lt;</span><span class="n">Int</span><span class="p">&gt;</span> <span class="p">=</span> <span class="n">flowOf</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">2</span><span class="p">,</span><span class="m">3</span><span class="p">,</span><span class="m">4</span><span class="p">)</span>
            <span class="n">collectWhileInAnyState</span><span class="p">(</span> <span class="n">aFlow</span> <span class="p">)</span> <span class="p">{</span> <span class="n">value</span><span class="p">,</span> <span class="n">getState</span><span class="p">,</span> <span class="n">setState</span> <span class="p">-&gt;</span>
                <span class="c1">// Will trigger anytime flow emits a value</span>
                <span class="p">...</span>
            <span class="p">}</span>

            <span class="n">collectWhileInAnyState</span><span class="p">(</span> <span class="n">anotherFlow</span> <span class="p">)</span> <span class="p">{</span> <span class="n">value</span><span class="p">,</span> <span class="n">getState</span><span class="p">,</span> <span class="n">setState</span> <span class="p">-&gt;</span>
                <span class="c1">// Will trigger anytime flow emits a value</span>
               <span class="p">...</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<p><code>collectWhileInAnyState()</code> is like <code>collectWhileInState()</code> just that it is not bound to the current state like <code>collectWhileInState()</code> is.
<code>collectWhileInAnyState()</code> will stop collecting the passed in Flow only if the CoroutineScope of the whole FlowReduxStateMachine gets canceled.</p>
<h2 id="setstate">SetState<a class="headerlink" href="#setstate" title="Permanent link">&para;</a></h2>
<p>As you probably have already noticed from the sections above <code>setState</code> is a way to make you state machine transition to another state.
You can think of <code>SetState</code> as a function that gets the current state as input parameter and returns
the new State:</p>
<div class="highlight"><pre><span></span><code><span class="k">fun</span> <span class="nf">setState</span> <span class="p">(</span><span class="n">currentState</span> <span class="p">:</span> <span class="n">State</span><span class="p">)</span> <span class="p">:</span> <span class="n">State</span> <span class="p">{</span>
    <span class="k">val</span> <span class="py">newState</span> <span class="p">:</span> <span class="n">State</span> <span class="p">=</span>  <span class="p">...</span> <span class="c1">// compute new state somehow</span>
    <span class="k">return</span> <span class="n">newState</span>
<span class="p">}</span>
</code></pre></div>

<p>Due to some kotlin language restriction <code>SetState</code> is actually a <code>class</code> and not just a function but that doesn&rsquo;t have to bother you as it is an implementation detail of FlowRedux.
You can totally think of it as a function <code>(State) -&gt; State</code>.</p>
<p>One important thing you have to know about FlowRedux in general is that FlowRedux is running async.
That means that there might be multiple <code>setState { ... }</code> in the queue trying to change the state (but only 1 SetState will be actually executed at the same time).</p>
<p>This means that it is possible that on <code>setState { ... }</code> execution the state is actually not in the same state anymore as you would have expected.
Per default FlowRedux will check if the state is still the expected one and if it isn&rsquo;t <code>setState {...}</code> wont run.</p>
<p>If you want to override this behavior you can do that by providing an additional parameter <code>runIf</code> and return true if FlowRedux should run setState, otherwise false.</p>
<div class="highlight"><pre><span></span><code><span class="n">setState</span><span class="p">(</span><span class="n">runIf</span> <span class="p">=</span> <span class="p">{</span> <span class="n">currentState</span> <span class="p">-&gt;</span> <span class="n">currentState</span> <span class="k">is</span> <span class="n">FooState</span> <span class="p">})</span> <span class="p">{</span> <span class="n">currentState</span> <span class="p">-&gt;</span>
    <span class="c1">// executed only if runIf returns true</span>
    <span class="n">OtherState</span>
<span class="p">}</span>
</code></pre></div>

<p>For example if you want to force setState to run always you can do the following:</p>
<div class="highlight"><pre><span></span><code><span class="n">setState</span><span class="p">(</span><span class="n">runIf</span> <span class="p">=</span> <span class="p">{</span> <span class="k">true</span> <span class="p">})</span> <span class="p">{</span> <span class="n">currentState</span> <span class="p">-&gt;</span>
    <span class="n">OtherState</span>
<span class="p">}</span>
</code></pre></div>

<h2 id="getstate">GetState<a class="headerlink" href="#getstate" title="Permanent link">&para;</a></h2>
<p>If you need in any block the current state <code>GetState</code> is your friend.
It is actually just a function that you can invoke that returns you the current state of your state machine.</p>
<h2 id="flatmappolicy">FlatMapPolicy<a class="headerlink" href="#flatmappolicy" title="Permanent link">&para;</a></h2>
<p>Have you ever wondered what would happen if you would execute <code>Action</code> very fast 1 after another?
For example:</p>
<div class="highlight"><pre><span></span><code><span class="n">spec</span> <span class="p">{</span>
    <span class="n">inState</span><span class="p">&lt;</span><span class="n">FooState</span><span class="p">&gt;</span> <span class="p">{</span>
        <span class="n">on</span><span class="p">&lt;</span><span class="n">BarAction</span><span class="p">&gt;</span> <span class="p">{</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="p">,</span> <span class="n">setState</span> <span class="p">-&gt;</span>
            <span class="n">delay</span><span class="p">(</span><span class="m">5000</span><span class="p">)</span> <span class="c1">// wait for 5000 seconds</span>
            <span class="n">setState</span> <span class="p">{</span> <span class="n">OtherState</span> <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<p>The example above shows a problem with async. state machines like FlowRedux:
If we our state machine is in <code>FooState</code> and a <code>BarAction</code> got triggered, we wait for 5 seconds and then set the state to another state.
What if while waiting 5 seconds (i.e. let&rsquo;s say after 3 seconds of waiting) another <code>BarAction</code> gets triggered.
That is possible right?
With <code>FlatMapPolicy</code> you can specify what should happen in that case.
There are three options to choose from:</p>
<ul>
<li><code>LATEST</code>: This is the default one. It would cancel any previous execution and just run the latest one.
In the example above it would mean while waiting 5 seconds another <code>BarAction</code> gets triggered, the first execution of <code>on&lt;BarAction&gt;</code> block gets stopped and a new <code>on&lt;BarAction&gt;</code> block starts.</li>
<li><code>MERGE</code>: Choosing this causes all the blocks to continue running but there are no guarantees in which order. For example:
<div class="highlight"><pre><span></span><code><span class="n">spec</span> <span class="p">{</span>
    <span class="n">inState</span><span class="p">&lt;</span><span class="n">FooState</span><span class="p">&gt;</span> <span class="p">{</span>
        <span class="n">on</span><span class="p">&lt;</span><span class="n">BarAction</span><span class="p">&gt;(</span><span class="n">flatMapPolicy</span> <span class="p">=</span> <span class="n">FlapMapPolicy</span><span class="p">.</span><span class="n">MERGE</span><span class="p">)</span> <span class="p">{</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="p">,</span> <span class="n">setState</span> <span class="p">-&gt;</span>
            <span class="n">delay</span><span class="p">(</span> <span class="n">randomInt</span><span class="p">()</span> <span class="p">)</span> <span class="c1">// wait for some random time</span>
            <span class="n">setState</span> <span class="p">{</span> <span class="n">OtherState</span> <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
Let&rsquo;s assume that  we trigger two times <code>BarAction</code>.
We use random amount of seconds for waiting.
Since we use <code>MERGE</code> <code>on&lt;BarAction&gt;</code> block gets executed 2 times without canceling the previous one (that is the difference to <code>LATEST</code>).
Moreover, <code>MERGE</code> doesn&rsquo;t make any promise on order of execution of the block (see <code>CONCAT</code> if you need promises on order).
So if <code>on&lt;BarAction&gt;</code> gets executed two times it will run in parallel and the the second execution could complete before the first execution (because using a random time of waiting).</li>
<li><code>CONCAT</code>: In contrast to <code>MERGE</code> and <code>LATEST</code> <code>CONCAT</code> will not run <code>on&lt;BarAction&gt;</code> in parallel and will not cancel any previous execution. Instead, <code>CONCAT</code> will preserve the order and execute one block after another.</li>
</ul>
<p>All execution blocks can specify a <code>FlatMapPolicy</code>:</p>
<ul>
<li><code>on&lt;Action&gt;(flatMapPolicy = FlatMapPolicy.LATEST){... }</code></li>
<li><code>onEnter(flatMapPolicy = FlatMapPolicy.LATEST) { ... }</code></li>
<li><code>collectWhileInState(flatMapPolicy = FlatMapPolicy.LATEST) { ... }</code></li>
</ul>
<h2 id="best-practice">Best Practice<a class="headerlink" href="#best-practice" title="Permanent link">&para;</a></h2>
<p>One very important aspect of the DSL is to provide a readable and maintainable way to reason about your state machine.
Let&rsquo; take a look at our example state machine:</p>
<div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">MyStateMachine</span><span class="p">(</span>
    <span class="k">private</span> <span class="k">val</span> <span class="py">httpClient</span><span class="p">:</span> <span class="n">HttpClient</span>
<span class="p">)</span> <span class="p">:</span> <span class="n">FlowReduxStateMachine</span><span class="p">&lt;</span><span class="n">State</span><span class="p">,</span> <span class="n">Action</span><span class="p">&gt;(</span><span class="n">initialState</span> <span class="p">=</span> <span class="n">LoadingState</span><span class="p">)</span> <span class="p">{</span>

    <span class="n">init</span> <span class="p">{</span>
        <span class="n">spec</span> <span class="p">{</span>
            <span class="n">inState</span><span class="p">&lt;</span><span class="n">LoadingState</span><span class="p">&gt;</span> <span class="p">{</span>
                <span class="n">onEnter</span> <span class="p">{</span> <span class="n">getState</span><span class="p">,</span> <span class="n">setState</span> <span class="p">-&gt;</span>
                    <span class="c1">// we entered the LoadingState, so let&#39;s do the http request</span>
                    <span class="k">try</span> <span class="p">{</span>
                        <span class="k">val</span> <span class="py">items</span> <span class="p">=</span> <span class="n">httpClient</span><span class="p">.</span><span class="n">loadItems</span><span class="p">()</span>
                        <span class="n">setState</span> <span class="p">{</span> <span class="n">ShowContentState</span><span class="p">(</span><span class="n">items</span><span class="p">)</span> <span class="p">}</span>
                    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">t</span> <span class="p">:</span> <span class="n">Throwable</span><span class="p">)</span> <span class="p">{</span>
                        <span class="n">setState</span> <span class="p">{</span> <span class="n">ErrorState</span><span class="p">(</span><span class="n">cause</span> <span class="p">=</span> <span class="n">t</span><span class="p">,</span> <span class="n">countdown</span> <span class="p">=</span> <span class="m">3</span><span class="p">)</span> <span class="p">}</span> <span class="c1">// Countdown starts with 3 seconds</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span>

            <span class="n">inState</span><span class="p">&lt;</span><span class="n">ErrorState</span><span class="p">&gt;</span> <span class="p">{</span>
               <span class="n">on</span><span class="p">&lt;</span><span class="n">RetryLoadingAction</span><span class="p">&gt;</span> <span class="p">{</span> <span class="n">action</span><span class="p">,</span> <span class="n">getState</span><span class="p">,</span> <span class="n">setState</span> <span class="p">-&gt;</span>
                  <span class="n">setState</span> <span class="p">{</span> <span class="n">LoadingState</span> <span class="p">}</span>
               <span class="p">}</span>

               <span class="k">val</span> <span class="py">timer</span> <span class="p">:</span> <span class="n">Flow</span><span class="p">&lt;</span><span class="n">Int</span><span class="p">&gt;</span> <span class="p">=</span> <span class="n">timerThatEmitsEverySecond</span><span class="p">()</span>
               <span class="n">collectWhileInState</span><span class="p">(</span><span class="n">timer</span><span class="p">)</span> <span class="p">{</span> <span class="n">value</span><span class="p">,</span> <span class="n">getState</span><span class="p">,</span> <span class="n">setState</span> <span class="p">-&gt;</span>
                    <span class="c1">// This block triggers every time the timer emits</span>
                    <span class="c1">// which happens every second</span>
                    <span class="k">val</span> <span class="py">state</span> <span class="p">=</span> <span class="n">getState</span><span class="p">()</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">state</span> <span class="k">is</span> <span class="n">ErrorState</span><span class="p">)</span> <span class="p">{</span>
                        <span class="k">val</span> <span class="py">countdownTimeLeft</span> <span class="p">=</span> <span class="n">state</span><span class="p">.</span><span class="n">countdown</span>
                        <span class="k">if</span> <span class="p">(</span><span class="n">countdownTimeLeft</span> <span class="p">&gt;</span> <span class="m">0</span><span class="p">)</span>
                            <span class="n">setState</span> <span class="p">{</span> <span class="n">state</span><span class="p">.</span><span class="n">copy</span><span class="p">(</span><span class="n">countdown</span> <span class="p">=</span> <span class="n">countdownTimeLeft</span> <span class="p">-</span> <span class="m">1</span><span class="p">)</span> <span class="p">}</span> <span class="c1">//  decrease the countdown by 1 second</span>
                        <span class="k">else</span>
                            <span class="n">setState</span> <span class="p">{</span> <span class="n">LoadingState</span> <span class="p">}</span> <span class="c1">// transition to the LoadingState</span>
                    <span class="p">}</span>
               <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">private</span> <span class="k">fun</span> <span class="nf">timerThatEmitsEverySecond</span><span class="p">()</span> <span class="p">:</span> <span class="n">Flow</span><span class="p">&lt;</span><span class="n">Int</span><span class="p">&gt;</span> <span class="p">{</span>
        <span class="k">var</span> <span class="py">timeElapsed</span> <span class="p">=</span> <span class="m">0</span>
        <span class="k">while</span> <span class="p">(</span><span class="n">isActive</span><span class="p">)</span> <span class="p">{</span>  <span class="c1">// is Flow still active?</span>
            <span class="n">delay</span><span class="p">(</span><span class="m">1000</span><span class="p">)</span>     <span class="c1">// wait 1 second</span>
            <span class="n">timeElapsed</span><span class="p">++</span>
            <span class="n">emit</span><span class="p">(</span><span class="n">timeElapsed</span><span class="p">)</span> <span class="c1">// Flow Emits value</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<p>Do you notice something?
With more blocks we add the state machine itself gets harder to read, understand and maintain.
What we are aiming for with the DSL is an overview about what the state machine is supposed to do on a high level that reads like as specification.
If you take a look at the example from above, however, you will notice that it isn&rsquo;t easy to read and get bloated with implementation details.</p>
<h3 id="the-recommended-way">The recommended way<a class="headerlink" href="#the-recommended-way" title="Permanent link">&para;</a></h3>
<p>We recommend to keep the DSL really short, expressive, readable and maintainable.
Therefore instead of having implementation details in your DSL we recommend to use function references instead.
Let&rsquo;s refactor the example above to reflect this idea:</p>
<div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">MyStateMachine</span><span class="p">(</span>
    <span class="k">private</span> <span class="k">val</span> <span class="py">httpClient</span><span class="p">:</span> <span class="n">HttpClient</span>
<span class="p">)</span> <span class="p">:</span> <span class="n">FlowReduxStateMachine</span><span class="p">&lt;</span><span class="n">State</span><span class="p">,</span> <span class="n">Action</span><span class="p">&gt;(</span><span class="n">initialState</span> <span class="p">=</span> <span class="n">LoadingState</span><span class="p">)</span> <span class="p">{</span>

    <span class="c1">//</span>
    <span class="c1">// This is the specification of your state machine. Less implementation details, better readability.</span>
    <span class="c1">//</span>
    <span class="n">init</span> <span class="p">{</span>
        <span class="n">spec</span> <span class="p">{</span>
            <span class="n">inState</span><span class="p">&lt;</span><span class="n">LoadingState</span><span class="p">&gt;</span> <span class="p">{</span>
                <span class="n">onEnter</span><span class="p">(</span><span class="o">::</span><span class="n">loadItemsAndMoveToContentOrErrorState</span><span class="p">)</span>
            <span class="p">}</span>

            <span class="n">inState</span><span class="p">&lt;</span><span class="n">ErrorState</span><span class="p">&gt;</span> <span class="p">{</span>
               <span class="n">on</span><span class="p">&lt;</span><span class="n">RetryLoadingAction</span><span class="p">&gt;</span> <span class="p">{</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">setState</span> <span class="p">-&gt;</span>
                  <span class="c1">// For a single line statement it&#39;s ok to keep the block instead of moving to a function reference</span>
                  <span class="n">setState</span> <span class="p">{</span> <span class="n">LoadingState</span> <span class="p">}</span>
               <span class="p">}</span>

               <span class="n">collectWhileInState</span><span class="p">(</span>
                    <span class="n">timerThatEmitsEverySecond</span><span class="p">(),</span>
                    <span class="o">::</span><span class="n">onSecondElapsedMoveToLoadingStateOrMoveToDecrementCountdown</span>
               <span class="p">)</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>


    <span class="c1">//</span>
    <span class="c1">// All the implementation details are in the functions below.</span>
    <span class="c1">//</span>

    <span class="k">private</span> <span class="k">fun</span> <span class="nf">loadItemsAndMoveToContentOrErrorState</span><span class="p">(</span><span class="n">getState</span> <span class="p">:</span> <span class="n">GetState</span><span class="p">&lt;</span><span class="n">State</span><span class="p">&gt;,</span> <span class="n">setState</span> <span class="p">:</span> <span class="n">SetState</span><span class="p">&lt;</span><span class="n">State</span><span class="p">&gt;){</span>
        <span class="k">try</span> <span class="p">{</span>
            <span class="k">val</span> <span class="py">items</span> <span class="p">=</span> <span class="n">httpClient</span><span class="p">.</span><span class="n">loadItems</span><span class="p">()</span>
            <span class="n">setState</span> <span class="p">{</span> <span class="n">ShowContentState</span><span class="p">(</span><span class="n">items</span><span class="p">)</span> <span class="p">}</span>
        <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">t</span> <span class="p">:</span> <span class="n">Throwable</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">setState</span> <span class="p">{</span> <span class="n">ErrorState</span><span class="p">(</span><span class="n">cause</span> <span class="p">=</span> <span class="n">t</span><span class="p">,</span> <span class="n">countdown</span> <span class="p">=</span> <span class="m">3</span><span class="p">)</span> <span class="p">}</span> <span class="c1">// Countdown starts with 3 seconds</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">private</span> <span class="k">fun</span> <span class="nf">onSecondElapsedMoveToLoadingStateOrMoveToDecrementCountdown</span><span class="p">(</span>
        <span class="n">value</span> <span class="p">:</span> <span class="n">Int</span><span class="p">,</span>
        <span class="n">getState</span> <span class="p">:</span> <span class="n">GetState</span><span class="p">&lt;</span><span class="n">State</span><span class="p">&gt;,</span>
        <span class="n">setState</span> <span class="p">:</span> <span class="n">SetState</span><span class="p">&lt;</span><span class="n">State</span><span class="p">&gt;</span>
    <span class="p">){</span>
        <span class="k">val</span> <span class="py">state</span> <span class="p">=</span> <span class="n">getState</span><span class="p">()</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">state</span> <span class="k">is</span> <span class="n">ErrorState</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">val</span> <span class="py">countdownTimeLeft</span> <span class="p">=</span> <span class="n">state</span><span class="p">.</span><span class="n">countdown</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">countdownTimeLeft</span> <span class="p">&gt;</span> <span class="m">0</span><span class="p">)</span>
                <span class="n">setState</span> <span class="p">{</span> <span class="n">state</span><span class="p">.</span><span class="n">copy</span><span class="p">(</span><span class="n">countdown</span> <span class="p">=</span> <span class="n">countdownTimeLeft</span> <span class="p">-</span> <span class="m">1</span><span class="p">)</span> <span class="p">}</span> <span class="c1">//  decrease the countdown by 1 second</span>
            <span class="k">else</span>
                <span class="n">setState</span> <span class="p">{</span> <span class="n">LoadingState</span> <span class="p">}</span> <span class="c1">// transition to the LoadingState</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">private</span> <span class="k">fun</span> <span class="nf">timerThatEmitsEverySecond</span><span class="p">()</span> <span class="p">:</span> <span class="n">Flow</span><span class="p">&lt;</span><span class="n">Int</span><span class="p">&gt;</span> <span class="p">{</span>
        <span class="k">var</span> <span class="py">timeElapsed</span> <span class="p">=</span> <span class="m">0</span>
        <span class="k">while</span> <span class="p">(</span><span class="n">isActive</span><span class="p">)</span> <span class="p">{</span>  <span class="c1">// is Flow still active?</span>
            <span class="n">delay</span><span class="p">(</span><span class="m">1000</span><span class="p">)</span>     <span class="c1">// wait 1 second</span>
            <span class="n">timeElapsed</span><span class="p">++</span>
            <span class="n">emit</span><span class="p">(</span><span class="n">timeElapsed</span><span class="p">)</span> <span class="c1">// Flow Emits value</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<p>By using function references you can read the DSL better and can zoom in into implementation
details anytime you want to by looking into a function body.</p>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid" aria-label="Footer">
        
          <a href="../contributing/" title="Contributing" class="md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
            </div>
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Contributing
              </div>
            </div>
          </a>
        
        
          <a href="../flow_vs_FlowReduxStateMachine/" title="FlowReduxStateMachine vs .reduxStore()" class="md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                FlowReduxStateMachine vs .reduxStore()
              </div>
            </div>
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4,11V13H16L10.5,18.5L11.92,19.92L19.84,12L11.92,4.08L10.5,5.5L16,11H4Z" /></svg>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2020 Freeletics.
          </div>
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/vendor.c51dfa35.min.js"></script>
      <script src="../assets/javascripts/bundle.eaaa3931.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents"}</script>
      
      <script>
        app = initialize({
          base: "..",
          features: [],
          search: Object.assign({
            worker: "../assets/javascripts/worker/search.58d22e8e.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
    
  </body>
</html>